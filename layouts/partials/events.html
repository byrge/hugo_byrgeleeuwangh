{{ $icon_loudspeaker := ":loudspeaker:" }}

<!-- Get CSV data -->
{{ $url := "/data/events/events.csv" }}
{{ $sep := "," }}
{{ $events := getCSV $sep $url }}
{{ range $i, $r := $events }}
        <!-- not first row because of headers -->
    {{ if ne $i 0 }}
        <!-- define variables -->
        {{ $event_start_date := index $r 1 }}
        {{ $event_start_date := (time $event_start_date) }}
        {{ $event_end_date := index $r 2 }}
        {{ $event_end_date := (time $event_end_date) }}
        {{ $event_name := index $r 0 }}
        {{ $event_location := index $r 3 }}
        {{ $event_url := index $r 4 }}

        <!-- date logic for showing events 1 month before the event -->
        {{ $show_event := $event_start_date.After now }}
        {{ $show_event_start := $event_start_date.AddDate 0 -1 0 }}
        {{ $show_event_publishdate := $show_event_start.Before now }}

        <!-- show on homepage -->
        {{- if and ($show_event) ($show_event_publishdate) ($.homepage) }}
        <article class="event-entry">
            <table class="eventhome">
                <tr>
                    <td title="upcoming event: {{ $event_name }}" data-analytics-event= "{{ $r | jsonify }}" title="event {{ $event_name }}" class="event homepage"><span class="mirror">{{ $icon_loudspeaker | emojify }}</span> <a href="/events">{{ $event_start_date.Month }} {{ $event_start_date.Day }}, {{ $event_start_date.Year }}: {{ $event_name }}, {{ $event_location }}</a></td>
                </tr>
            </table>
        </article>
        {{- end }}
    {{- end }}
{{- end }}

<!-- show upcoming event -->
{{ range $i, $r := $events }}
{{- if eq $i 0 }}{{- if not $.homepage }}<h3 class="events first">first upcoming event</h3>{{- end }}{{- end }}
        <!-- not first row because of headers -->
    {{ if ne $i 0 }}
        <!-- define variables -->
        {{ $event_start_date := index $r 1 }}
        {{ $event_start_date := (time $event_start_date) }}
        {{ $event_end_date := index $r 2 }}
        {{ $event_end_date := (time $event_end_date) }}
        {{ $event_name := index $r 0 }}
        {{ $event_location := index $r 3 }}
        {{ $event_url := index $r 4 }}

        <!-- date logic for showing events 1 month before the event -->
        {{ $show_event := $event_start_date.After now }}
        {{ $show_event_start := $event_start_date.AddDate 0 -1 0 }}
        {{ $show_event_publishdate := $show_event_start.Before now }}

        {{- if and ($show_event) ($show_event_publishdate) }}
        {{- if not $.homepage }}
        <article class="event-entry first">
            <table class="eventnothome">
                <tr>
                    <td title="upcoming event: {{ $event_name }}" data-analytics-event= "{{ $r | jsonify }}" title="event {{ $event_name }}" class="event homepage" colspan="3"><span class="mirror">{{ $icon_loudspeaker | emojify }}</span> <a href="{{ $event_url }}">{{ $event_start_date.Month }} {{ $event_start_date.Day }}, {{ $event_start_date.Year }}: {{ $event_name }}, {{ $event_location }}</a></td>
                </tr>
            </table>
        </article>
        {{- end }}
        {{- end }}
    {{- end }}
{{- end }}

<!-- show coming events -->
{{ range $i, $r := $events }}
{{- if eq $i 0 }}{{- if not $.homepage }}<h3 class="events">coming events</h3>{{- end }}{{- end }}
        <!-- not first row because of headers -->
    {{ if ne $i 0 }}
        <!-- define variables -->
        {{ $event_start_date := index $r 1 }}
        {{ $event_start_date := (time $event_start_date) }}
        {{ $event_end_date := index $r 2 }}
        {{ $event_end_date := (time $event_end_date) }}
        {{ $event_name := index $r 0 }}
        {{ $event_location := index $r 3 }}
        {{ $event_url := index $r 4 }}

        <!-- date logic for showing events 1 month before the event -->
        {{ $show_event := $event_start_date.After now }}
        {{ $show_event_start := $event_start_date.AddDate 0 -1 0 }}
        {{ $show_event_publishdate := $show_event_start.Before now }}

        {{- if ($show_event) }}
        {{- if not $.homepage }}
        <article class="event-entry">
            <table class="eventnothome">
                <!-- <tr>
                    <td class="event list"><span class="bold">Date</span></td>
                    <td class="event list"><span class="bold">Event</span></td>
                    <td class="event list"><span class="bold">Location</span></td>
                </tr> -->
                <tr data-analytics-event= "{{ $r | jsonify }}" title="event {{ $event_name }}" class="event list">
                    <td class="event list"><span><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path d="M17 3v-2c0-.552.447-1 1-1s1 .448 1 1v2c0 .552-.447 1-1 1s-1-.448-1-1zm-12 1c.553 0 1-.448 1-1v-2c0-.552-.447-1-1-1-.553 0-1 .448-1 1v2c0 .552.447 1 1 1zm13 13v-3h-1v4h3v-1h-2zm-5 .5c0 2.481 2.019 4.5 4.5 4.5s4.5-2.019 4.5-4.5-2.019-4.5-4.5-4.5-4.5 2.019-4.5 4.5zm11 0c0 3.59-2.91 6.5-6.5 6.5s-6.5-2.91-6.5-6.5 2.91-6.5 6.5-6.5 6.5 2.91 6.5 6.5zm-14.237 3.5h-7.763v-13h19v1.763c.727.33 1.399.757 2 1.268v-9.031h-3v1c0 1.316-1.278 2.339-2.658 1.894-.831-.268-1.342-1.111-1.342-1.984v-.91h-9v1c0 1.316-1.278 2.339-2.658 1.894-.831-.268-1.342-1.111-1.342-1.984v-.91h-3v21h11.031c-.511-.601-.938-1.273-1.268-2z"/></svg></span> {{ $event_start_date.Month }} {{ $event_start_date.Day }}, {{ $event_start_date.Year }}</td>
                    <td class="event list"><span><svg class="icon" width="33" height="33" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"><path d="M14.851 11.923c-.179-.641-.521-1.246-1.025-1.749-1.562-1.562-4.095-1.563-5.657 0l-4.998 4.998c-1.562 1.563-1.563 4.095 0 5.657 1.562 1.563 4.096 1.561 5.656 0l3.842-3.841.333.009c.404 0 .802-.04 1.189-.117l-4.657 4.656c-.975.976-2.255 1.464-3.535 1.464-1.28 0-2.56-.488-3.535-1.464-1.952-1.951-1.952-5.12 0-7.071l4.998-4.998c.975-.976 2.256-1.464 3.536-1.464 1.279 0 2.56.488 3.535 1.464.493.493.861 1.063 1.105 1.672l-.787.784zm-5.703.147c.178.643.521 1.25 1.026 1.756 1.562 1.563 4.096 1.561 5.656 0l4.999-4.998c1.563-1.562 1.563-4.095 0-5.657-1.562-1.562-4.095-1.563-5.657 0l-3.841 3.841-.333-.009c-.404 0-.802.04-1.189.117l4.656-4.656c.975-.976 2.256-1.464 3.536-1.464 1.279 0 2.56.488 3.535 1.464 1.951 1.951 1.951 5.119 0 7.071l-4.999 4.998c-.975.976-2.255 1.464-3.535 1.464-1.28 0-2.56-.488-3.535-1.464-.494-.495-.863-1.067-1.107-1.678l.788-.785z"/></svg></span> <a class="event" href="{{ $event_url }}" target="_blank" rel="noopener noreferrer">{{ $event_name }}</a></td>
                    <td class="event list"><span><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></svg></span> {{ $event_location }}</td>
                </tr>
            </table>
        </article>
        {{- end }}
        {{- end }}
    {{- end }}
{{- end }}

<!-- show past events -->
{{ range $i, $r := $events }}
{{- if eq $i 0 }}{{- if not $.homepage }}<h3 class="events">past events</h3>{{- end }}{{- end }}
        <!-- not first row because of headers -->
    {{ if ne $i 0 }}
        <!-- define variables -->
        {{ $event_start_date := index $r 1 }}
        {{ $event_start_date := (time $event_start_date) }}
        {{ $event_end_date := index $r 2 }}
        {{ $event_end_date := (time $event_end_date) }}
        {{ $event_name := index $r 0 }}
        {{ $event_location := index $r 3 }}
        {{ $event_url := index $r 4 }}

        <!-- date logic for showing past events -->
         {{ $show_event_past := $event_start_date.Before now }}
        {{- if ($show_event_past) }}
        {{- if not $.homepage }}
        <article class="event-entry">
            <table class="eventnothome">
                <!-- <tr>
                    <td class="event list"><span class="bold">Date</span></td>
                    <td class="event list"><span class="bold">Event</span></td>
                    <td class="event list"><span class="bold">Location</span></td>
                </tr> -->
                <tr data-analytics-event= "{{ $r | jsonify }}" title="event {{ $event_name }}" class="event list">
                    <td class="event list"><span><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path d="M17 3v-2c0-.552.447-1 1-1s1 .448 1 1v2c0 .552-.447 1-1 1s-1-.448-1-1zm-12 1c.553 0 1-.448 1-1v-2c0-.552-.447-1-1-1-.553 0-1 .448-1 1v2c0 .552.447 1 1 1zm13 13v-3h-1v4h3v-1h-2zm-5 .5c0 2.481 2.019 4.5 4.5 4.5s4.5-2.019 4.5-4.5-2.019-4.5-4.5-4.5-4.5 2.019-4.5 4.5zm11 0c0 3.59-2.91 6.5-6.5 6.5s-6.5-2.91-6.5-6.5 2.91-6.5 6.5-6.5 6.5 2.91 6.5 6.5zm-14.237 3.5h-7.763v-13h19v1.763c.727.33 1.399.757 2 1.268v-9.031h-3v1c0 1.316-1.278 2.339-2.658 1.894-.831-.268-1.342-1.111-1.342-1.984v-.91h-9v1c0 1.316-1.278 2.339-2.658 1.894-.831-.268-1.342-1.111-1.342-1.984v-.91h-3v21h11.031c-.511-.601-.938-1.273-1.268-2z"/></svg></span> {{ $event_start_date.Month }} {{ $event_start_date.Day }}, {{ $event_start_date.Year }}</td>
                    <td class="event list"><span><svg class="icon" width="33" height="33" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"><path d="M14.851 11.923c-.179-.641-.521-1.246-1.025-1.749-1.562-1.562-4.095-1.563-5.657 0l-4.998 4.998c-1.562 1.563-1.563 4.095 0 5.657 1.562 1.563 4.096 1.561 5.656 0l3.842-3.841.333.009c.404 0 .802-.04 1.189-.117l-4.657 4.656c-.975.976-2.255 1.464-3.535 1.464-1.28 0-2.56-.488-3.535-1.464-1.952-1.951-1.952-5.12 0-7.071l4.998-4.998c.975-.976 2.256-1.464 3.536-1.464 1.279 0 2.56.488 3.535 1.464.493.493.861 1.063 1.105 1.672l-.787.784zm-5.703.147c.178.643.521 1.25 1.026 1.756 1.562 1.563 4.096 1.561 5.656 0l4.999-4.998c1.563-1.562 1.563-4.095 0-5.657-1.562-1.562-4.095-1.563-5.657 0l-3.841 3.841-.333-.009c-.404 0-.802.04-1.189.117l4.656-4.656c.975-.976 2.256-1.464 3.536-1.464 1.279 0 2.56.488 3.535 1.464 1.951 1.951 1.951 5.119 0 7.071l-4.999 4.998c-.975.976-2.255 1.464-3.535 1.464-1.28 0-2.56-.488-3.535-1.464-.494-.495-.863-1.067-1.107-1.678l.788-.785z"/></svg></span> <a class="event" href="{{ $event_url }}" target="_blank" rel="noopener noreferrer">{{ $event_name }}</a></td>
                    <td class="event list"><span><svg class="icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><path d="M12 0c-4.198 0-8 3.403-8 7.602 0 4.198 3.469 9.21 8 16.398 4.531-7.188 8-12.2 8-16.398 0-4.199-3.801-7.602-8-7.602zm0 11c-1.657 0-3-1.343-3-3s1.343-3 3-3 3 1.343 3 3-1.343 3-3 3z"/></svg></span> {{ $event_location }}</td>
                </tr>
            </table>
        </article>
        {{- end }}
        {{- end }}
    {{- end }}
{{- end }}