{{ $icon_loudspeaker := ":loudspeaker:" }}
{{ $icon_link := ":link:" }}
{{ $icon_date := ":calendar:" }}
{{ $icon_location := ":globe_showing_Europe-Africa:" }}
<article class="event-entry">
    {{- if not $.homepage }}
        <table class="eventoverview">
            <tr>
                <td class="event list"><span class="bold">Date</span></td>
                <td class="event list"><span class="bold">Event</span></td>
                <td class="event list"><span class="bold">Location</span></td>
            </tr>
            {{- end }}
        {{ $url := "/data/events/events.csv" }}
        {{ $sep := "," }}
        {{ range $i, $r := getCSV $sep $url }}
            {{ if ne $i 0 }}
                {{ $event_start_date := index $r 1 }}
                {{ $event_start_date := (time $event_start_date) }}
                {{ $event_end_date := index $r 2 }}
                {{ $event_end_date := (time $event_end_date) }}
                {{ $event_name := index $r 0 }}
                {{ $event_location := index $r 3 }}
                {{ $event_url := index $r 4 }}
                <!-- date logic for showing events 4 weeks before the event -->
                {{ $show_event := $event_start_date.After now }}
                {{ $show_event_start := $event_start_date.AddDate 0 -1 0 }}
                {{ $show_event_publishdate := $show_event_start.Before now }}
                {{- if and ($show_event) ($show_event_publishdate) ($.homepage) }}
                <!-- homepage event -->
                <table class="eventhome">
                    <tr>
                        <td title="upcoming event: {{ $event_name }}" data-analytics-event= "{{ $r | jsonify }}" title="event {{ $event_name }}" class="event homepage"><span class="mirror">{{ $icon_loudspeaker | emojify }}</span> <a href="/events">{{ $event_start_date.Month }} {{ $event_start_date.Day }}, {{ $event_start_date.Year }}: {{ $event_name }}, {{ $event_location }}</a></td>
                    </tr>
                {{- else if not $.homepage }}
                <!-- non homepage event overview -->
                    {{- if ($show_event) }}
                    <tr data-analytics-event= "{{ $r | jsonify }}" title="event {{ $event_name }}" class="event list">
                        <td class="event list"><span>{{ $icon_date | emojify }}</span> {{ $event_start_date.Month }} {{ $event_start_date.Day }}, {{ $event_start_date.Year }}</td>
                        <td class="event list"><span>{{ $icon_link | emojify }}</span> <a class="event" href="{{ $event_url }}" target="_blank" rel="noopener noreferrer">{{ $event_name }}</a></td>
                        <td class="event list"><span>{{ $icon_location | emojify }}</span> {{ $event_location }}</td>
                    </tr>
                    {{- end }}
                    <!-- events in the past -->
                    {{ $show_event_past := $event_start_date.Before now }}
                    {{- if ($show_event_past) }}
                    <tr class="event list past"><td class="event list" colspan="3"><span class="bold">Past events</span>
                    </br>I include the past events as an overview. Maybe they have links to Youtube recordings or other materials.</td></tr>

                    <tr data-analytics-event= "{{ $r | jsonify }}" title="event {{ $event_name }}" class="event list">
                        <td class="event list"><span>{{ $icon_date | emojify }}</span> {{ $event_start_date.Month }} {{ $event_start_date.Day }}, {{ $event_start_date.Year }}</td>
                        <td class="event list"><span>{{ $icon_link | emojify }}</span> <a class="event" href="{{ $event_url }}" target="_blank" rel="noopener noreferrer">{{ $event_name }}</a></td>
                        <td class="event list"><span>{{ $icon_location | emojify }}</span> {{ $event_location }}</td>
                    </tr>
                    {{- end }}
                {{- end }}
            {{- end }}
        {{- end }}
        </table>
        <p></p>
</article>